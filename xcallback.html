<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>X OAuth 認証コールバック</title>
  <script>
    // X（Twitter）の認証プロセスでは、認証後にこのページに以下のようなクエリパラメータが付与されて戻ってきます
    // 例: ?code=XXXX&state=YYYY （OAuth 2.0の場合）
    // これらのパラメータは認証プロセスを完了するために必要です
    const queryParams = window.location.search;

    if (queryParams) {

      // GAS側のコールバックURLを設定します（YOUR_SCRIPT_ID を実際のスクリプトIDに置き換えてください）
      // OAuth 2.0 User Contextを使用するため、/usercallbackエンドポイントを使用します
      //   const gasCallbackUrl = 'https://script.google.com/macros/d/YOUR_SCRIPT_ID/usercallback'
      const gasCallbackUrl = 'https://script.google.com/macros/d/1vKbQ2yiYgkQM_1hI9fiRvRoHDfZ_SjzAF42rP-z4q5z563xLp0YldsC0/usercallback';
      
      // GASのコールバックURLにクエリパラメータを付与してリダイレクトします
      window.location.href = gasCallbackUrl + queryParams;
    } else {
      // クエリパラメータがない場合はエラーメッセージを表示
      document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('error-message').style.display = 'block';
      });
    }
  </script>
</head>
<body>
  <h1>X認証処理中</h1>
  <p>認証処理を実行中です。自動的にリダイレクトされない場合は、下記のリンクをクリックしてください。</p>
  <p><a id="redirect-link" href="#">リダイレクトする</a></p>
  <div id="error-message" style="display: none; color: red;">
    <p>エラー: 認証パラメータが見つかりません。X認証プロセスを最初からやり直してください。</p>
  </div>
  <script>
    // 予備のリンクにも同じURLを設定します
    // これは自動リダイレクトが機能しない場合のフォールバック（予備）として用意されています
    if (queryParams) {
    // const gasCallbackUrl = 'https://script.google.com/macros/d/YOUR_SCRIPT_ID/usercallback';
      const gasCallbackUrl = 'https://script.google.com/macros/d/1vKbQ2yiYgkQM_1hI9fiRvRoHDfZ_SjzAF42rP-z4q5z563xLp0YldsC0/usercallback';
      document.getElementById('redirect-link').href = gasCallbackUrl + queryParams;
    }
  </script>
</body>
</html>